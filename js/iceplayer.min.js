/*
 IcePlayer v.2.0.0 - Player for Site (Icecast2 Online Radio)
 Copyright (c) 2016-2020 Andrew Molchanov
 https://github.com/JoCat/IcePlayer
*/
"use strict";const IcePlayer={server_address:"http://127.0.0.1:8000/",stream_mount:"live",style:"fixed",mounts_list:["live","nonstop"],info_link:"current_track.xsl",time_update:10,audio_object:new Audio,current_state:0,STOPPED:0,PLAYING:1,PAUSED:2,init(e){if("object"==typeof e){const t=Object.keys(e);for(let i of t)this[i]=e[i]}this.get_element("#ice-player").classList.add(this.style),this.set_content("#ice-player",'<div id="ice-player-el"><i id="ice-play"></i><i id="ice-pause"></i><i id="ice-stop"></i><input id="ice-volume" type="range" min="0" max="100" value="50" step="1"></i><span id="ice-track"></span>'),this.audio_object.volume=.5,this.get_element("#ice-play").addEventListener("click",()=>{this.play()}),this.get_element("#ice-pause").addEventListener("click",()=>{this.pause()}),this.get_element("#ice-stop").addEventListener("click",()=>{this.stop()}),this.get_element("#ice-volume").addEventListener("mousemove",()=>{this.change_volume()}),this.audio_object.addEventListener("play",()=>{this.current_state=this.PLAYING,this.play_pause_toggle()}),this.audio_object.addEventListener("pause",()=>{this.current_state=this.PAUSED,this.play_pause_toggle()}),this.showinfo()},play(){this.current_state===this.STOPPED&&this.audio_object.setAttribute("src",this.server_address+this.stream_mount),this.audio_object.play()},pause(){this.audio_object.pause()},stop(){this.audio_object.pause(),this.audio_object.setAttribute("src",""),this.current_state=this.STOPPED,this.play_pause_toggle()},change_volume(e){this.audio_object.volume=this.get_element("#ice-volume").value/100},showinfo(){this.request(this.server_address+this.info_link,e=>{for(let t of this.mounts_list)if(e[t]){this.set_content("#ice-track",e[t].title);break}}),this.timer=setTimeout(()=>{this.showinfo()},1e3*this.time_update)},play_pause_toggle(){this.current_state===this.PLAYING?(this.hide("#ice-play"),this.show("#ice-pause")):(this.hide("#ice-pause"),this.show("#ice-play"))},get_element:e=>"object"==typeof e?e:document.querySelector(e),set_content(e,t){this.get_element(e).innerHTML=t},request(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=function(){if(this.status>=200&&this.status<400){var e=JSON.parse(this.response);t(e)}},i.send()},hide(e){this.get_element(e).style.display="none"},show(e){this.get_element(e).style.display="inline-flex"}};