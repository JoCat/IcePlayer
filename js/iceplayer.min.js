"use strict";class IcePlayer{constructor(e,t){if(0===e.length)throw new Error("Player element not found!");if(this.server_address="http://127.0.0.1:8000/",this.stream_mount="live",this.style="fixed",this.template='<div class="ice-player-el"><i class="ice-play"></i><i class="ice-pause"></i><i class="ice-stop"></i><input class="ice-volume" type="range" min="0" max="100" value="50" step="1"><span class="ice-track"></span></div>',this.mounts_list=["live","nonstop"],this.info_link="current_track.xsl",this.time_update=10,this.audio_object=new Audio,this.audio_object.volume=.5,this.current_state=0,this.STOPPED=0,this.PLAYING=1,this.PAUSED=2,"object"==typeof t){const e=Object.keys(t).filter(e=>["server_address","stream_mount","style","template","mounts_list","info_link","time_update"].includes(e));for(let s of e)this[s]=t[s]}this.player_el=document.querySelector(e),this.player_el.classList.add("ice-player",this.style),this.set_content(this.player_el,this.template),this.get_element(".ice-play").addEventListener("click",()=>{this.play()}),this.get_element(".ice-pause").addEventListener("click",()=>{this.pause()}),this.get_element(".ice-stop").addEventListener("click",()=>{this.stop()}),this.get_element(".ice-volume").addEventListener("mousemove",()=>{this.change_volume()}),this.audio_object.addEventListener("play",()=>{this.current_state=this.PLAYING,this.play_pause_toggle()}),this.audio_object.addEventListener("pause",()=>{this.current_state=this.PAUSED,this.play_pause_toggle()}),this.showinfo()}play(){this.current_state===this.STOPPED&&this.audio_object.setAttribute("src",this.server_address+this.stream_mount+"?cache-ignore="+Date.now()),this.audio_object.play()}pause(){this.audio_object.pause()}stop(){this.audio_object.pause(),this.audio_object.setAttribute("src",""),this.current_state=this.STOPPED,this.play_pause_toggle()}change_volume(){this.audio_object.volume=this.get_element(".ice-volume").value/100}showinfo(){this.request(this.server_address+this.info_link,e=>{for(let t of this.mounts_list)if(e[t]){this.set_content(".ice-track",e[t].title);break}}),this.timer=setTimeout(()=>{this.showinfo()},1e3*this.time_update)}play_pause_toggle(){this.current_state===this.PLAYING?(this.hide(".ice-play"),this.show(".ice-pause")):(this.hide(".ice-pause"),this.show(".ice-play"))}get_element(e){return"object"==typeof e?e:this.player_el.querySelector(e)}set_content(e,t){this.get_element(e).innerHTML=t}request(e,t){var s=new XMLHttpRequest;s.open("GET",e,!0),s.onload=function(){if(this.status>=200&&this.status<400){var e=JSON.parse(this.response);t(e)}},s.send()}hide(e){this.get_element(e).style.display="none"}show(e){this.get_element(e).style.display="inline-flex"}}